明白，我帮你把这块逻辑整理成一份**规范文档**，便于后续开发和查阅：

---

# 临时数据文件生成逻辑文档

## 目的

生成临时数据文件用于**翻译管理**，保证：

- 已翻译的文案复用原翻译
- 新增或修改文案标记为待翻译
- 临时文件作为翻译服务调用的输入

---

## 处理流程

### 1. 扁平化主语言包

- 使用 **深度优先遍历** 将嵌套的 JSON 对象转换为扁平化 key
- 扁平化规则：嵌套路径使用 `.` 拼接，例如：

```json
输入：
{
  "menu": {
    "login": "登陆",
    "logout": "退出"
  }
}

输出：
{
  "menu.login": "登陆",
  "menu.logout": "退出"
}
```

- 扁平化后的数据记为 **A**

---

### 2. 遍历扁平化数据 A

对 A 中的每个 `key-value` 执行以下逻辑：

1. **key 不存在于数据文件**
   - 直接写入临时数据文件
   - 其它语言字段为空，等待翻译

2. **key 存在于数据文件**
   - **value 与数据中的原语言字段相同**
     - 将数据文件中该 key 的整个对象原样拷贝到临时数据文件
     - 该文案无需再翻译

   - **value 与数据中的原语言字段不同**
     - 替换原文
     - 清空其它语言字段，标记为待翻译

---

### 3. 临时数据文件结果

- **已翻译文案** → 保持原翻译
- **新增或修改文案** → 原文保留，其它语言字段为空
- 临时文件作为 **翻译服务调用的输入**

---

### 4. 使用说明

- 在 `i18n run` 流程中，**临时文件生成后**，只需提取待翻译部分进行翻译
- 翻译完成后，再合并回数据文件，保持数据为“唯一真相”

---

### 5. 核心特点

- **复用性**：已翻译内容无需重复翻译
- **增量更新**：只处理新增或修改文案
- **统一管理**：临时文件和数据文件分离，流程清晰
